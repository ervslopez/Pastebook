@model PastebookApp.Models.UserModel

<div class="col-md-4 well well-lg" id="profileHeader">
    <div class="container col-md-offset-2">
        <div>
            @{
                var base64 = Convert.ToBase64String(Model.PROFILE_PIC);
                var imgSrc = String.Format("data:image/gif;base64,{0}", base64);
            }
            <img src="@imgSrc" alt="Profile Picture" class="mainProfilePic img-circle" />
        </div>

        <div class="row">
            <div class="col-md-6">
                <label class="info">
                    @Html.DisplayNameFor(model => model.USER_NAME)
                </label>
                @Html.DisplayFor(model => model.USER_NAME)
                @Html.DisplayNameFor(model => model.FIRST_NAME)
                @Html.DisplayFor(model => model.FIRST_NAME)
                @Html.DisplayNameFor(model => model.LAST_NAME)
                @Html.DisplayFor(model => model.LAST_NAME)
            </div>
            <div class="col-md-6">
            </div>
        </div>
    </div>
</div>

<div class="col-md-8">

    <div class="panel panel-default">
        <div class="panel-heading" id="postHeader">
            <div>
                <span>
                    @DateTime.Now;
                </span>
            </div>
        </div>
        <div class="panel-body">
            <img src="@imgSrc" alt="Profile Picture" id="postProfilePic" class="img-circle col-md-3" />
            <textarea class="form-control col-md-6" id="postTxt"></textarea>
        </div>
        <div class="panel-footer">
            <button type="button" class="btn btn-success pull-right" onclick="newPost()" id="btnPost">Publish</button>
        </div>
    </div>
    <div id="postsPage">
        @{
            Html.RenderAction("ViewPosts", "Pastebook", new { ID = Model.ID });
        }
    </div>
</div>


@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
    <script>
        var postUrl = '@Url.Action("PublishPost", "Pastebook")';
        var commentOnPostURL = '@Url.Action("CommentOnPost", "Pastebook")';
        var likePostURL = '@Url.Action("LikePost", "Pastebook")';
        var reloadUrl = '@Url.Action("ViewPosts", "Pastebook", new { ID = Model.ID })';

        function newPost() {
            var postString = $("#postTxt").val();
            if (postString.length > 0) {
                var data = {
                    posterId:@Model.ID,
                    postString : postString
                }
                $.ajax({
                    url: postUrl,
                    data: data,
                    success: function (data) {
                        SuccessPost(data)
                    },
                    error: function () {
                        alert("Somethin Went Wrong");
                    }
                });

                var SuccessPost = function(data){
                    $("#postTxt").val("");
                    $("#postsPage").load(reloadUrl);
                }

            } else {
                alert("Can't post nothin!");
            }
        }

        function commentOnPost(ID) {
            var comment = $("#"+ID.toString()).val();

            if (comment.length > 0) {
                var data = {
                    postID: ID,
                    comment: comment
                }
                $.ajax({
                    url: commentOnPostURL,
                    data: data,
                    success: function (data) {
                        SuccessPost(data)
                    },
                    error: function () {
                        alert("Somethin Went Wrong");
                    }
                });

                var SuccessPost = function (data) {
                    $("#commentTxt").val("");
                    $("#postsPage").load(reloadUrl);
                }

            } else {
                alert("Can't post nothin!");
            }
        }

        function likePost(ID){
            var data = {
                postID: ID
            }
            $.ajax({
                url: likePostURL,
                data: data,
                success: function (data) {
                    SuccessPost(data)
                },
                error: function () {
                    alert("Somethin Went Wrong");
                }
            });

            var SuccessPost = function (data) {
                $("#commentTxt").val("");
                $("#postsPage").load(reloadUrl);
            }
        }
    </script>
}
